<head>
    <style> body { margin: 0; } </style>
  
    <script src="//unpkg.com/react/umd/react.production.min.js"></script>
    <script src="//unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
    <script src="//unpkg.com/babel-standalone"></script>

    <script src="//unpkg.com/three"></script>
    <script src="//unpkg.com/three-spritetext"></script>
  
    <script src="//unpkg.com/react-force-graph-3d"></script>
    <!--<script src="../../src/packages/react-force-graph-3d/dist/react-force-graph-3d.js"></script>-->
  </head>
  
  <body>
    <div id="graph"></div>
  
    <script>
      UnrealBloomPassPromise = import('//cdn.skypack.dev/three/examples/jsm/postprocessing/UnrealBloomPass.js')
        .then(m => m.UnrealBloomPass);
    </script>
  
    <script type="text/jsx">
      UnrealBloomPassPromise.then(UnrealBloomPass => {
        const { useRef, useEffect, useCallback } = React;
  
        fetch('datasets/blocks.json').then(res => res.json()).then(data => {
          const FocusGraph = () => {
            const fgRef = useRef();
  
            useEffect(() => {
              const bloomPass = new UnrealBloomPass();
              bloomPass.strength = 1.5;
              bloomPass.radius = 1;
              bloomPass.threshold = 0.1;
              fgRef.current.postProcessingComposer().addPass(bloomPass);
            }, []);

            const handleClick = useCallback(node => {
                // Aim at node from outside it
                const distance = 40;
                const distRatio = 1 + distance/Math.hypot(node.x, node.y, node.z);
      
                fgRef.current.cameraPosition(
                  { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio }, // new position
                  node, // lookAt ({ x, y, z })
                  3000  // ms transition duration
                );
              }, [fgRef]);
  
            return <ForceGraph3D
              ref={fgRef}
              graphData={data}
              nodeLabel={node => `${node.user}: ${node.description}`}
              nodeAutoColorBy="user"
              nodeResolution={10}
              linkDirectionalParticles={1}
              onNodeClick={handleClick}

            />;
          };
  
          ReactDOM.render(
            <FocusGraph/>,
            document.getElementById('graph')
          );
        });
      });
    </script>
  </body>



  <!-- linkThreeObjectExtend={true}
  linkThreeObject={link => {
    const sprite = new SpriteText(`${link.source} > ${link.target}`);
    sprite.color = 'lightgrey';
    sprite.textHeight = 1.5;
    return sprite;
  }}
  linkPositionUpdate={(sprite, { start, end }) => {
    const middlePos = Object.assign(...['x', 'y', 'z'].map(c => ({
      [c]: start[c] + (end[c] - start[c]) / 2 // calc middle point
    })));
    Object.assign(sprite.position, middlePos);
  }} -->